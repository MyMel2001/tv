<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sparkSammy TV</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
            min-height: 100vh;
        }
        .container {
            display: flex;
            max-width: 1400px;
            margin: 20px auto;
            gap: 20px;
            padding: 0 20px;
        }
        /* Channel List - Left Side */
        #channel-sidebar {
            flex: 1;
            max-width: 30%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .channel-item {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .channel-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        .channel-item.active {
            background: #00d4ff;
            color: #000;
            font-weight: bold;
            border-color: #00a8cc;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
        }
        .channel-logo {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            margin-right: 14px;
            object-fit: contain;
            background: #000;
            padding: 4px;
            flex-shrink: 0;
        }
        .channel-name {
            flex: 1;
            font-size: 1.05em;
        }

        /* Player - Fixed on Right */
        #player-sidebar {
            width: 74%;
            flex-shrink: 0;
            position: sticky;
            top: 20px;
            height: calc(100vh - 40px);
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #video-player {
            width: 100%;
            height: 100%;
            background: #000;
        }
        #now-playing {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            font-size: 1.1em;
            text-align: center;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 6px solid #f3f3f3;
            border-top: 6px solid #00d4ff;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            z-index: 10;
        }
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 992px) {
            .container { flex-direction: column; }
            #player-sidebar, #channel-sidebar {
                width: 100%;
                max-width: none;
            }
            #player-sidebar {
                position: relative;
                height: 60vh;
                top: 0;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Channel List -->
    <div id="channel-sidebar">
        <h1>Live Channels</h1>
        <div id="channel-list"></div>
    </div>

    <!-- Sticky Player -->
    <div id="player-sidebar">
        <video id="video-player" controls autoplay loop></video>
        <div id="loader" class="loader" style="display: none;"></div>
        <div id="now-playing">Select a channel to watch</div>
    </div>
</div>

<script>
    // REPLACE THIS WITH YOUR LEGALLY OBTAINED M3U PLAYLIST URL
    const playlistUrl = 'https://raw.githubusercontent.com/mymel2001-holder/iptv-action/refs/heads/main/list.m3u'; // Sparksammy TV
    // Or paste raw M3U content directly below:
    // const playlistContent = `#EXTM3U\n#EXTINF:...`;

    let channels = [];
    const video = document.getElementById('video-player');
    const loader = document.getElementById('loader');
    const nowPlaying = document.getElementById('now-playing');
    const channelList = document.getElementById('channel-list');

    function parseM3U(text) {
        const lines = text.split('\n');
        let channel = {};

        lines.forEach(line => {
            line = line.trim();
            if (line.startsWith('#EXTINF:')) {
                const nameMatch = line.match(/,(.+)$/);
                const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                const groupMatch = line.match(/group-title="([^"]+)"/);

                channel = {
                    name: nameMatch ? nameMatch[1].trim() : 'Unknown Channel',
                    logo: logoMatch ? logoMatch[1] : '',
                    group: groupMatch ? groupMatch[1] : 'Uncategorized'
                };
            }
            else if (line && !line.startsWith('#') && channel.name) {
                channel.url = line;
                channels.push({ ...channel });
                channel = {};
            }
        });

        renderChannels();
    }

    function renderChannels() {
        channelList.innerHTML = '';
        channels.forEach((ch, i) => {
            const div = document.createElement('div');
            div.className = 'channel-item';
            div.innerHTML = `
                ${ch.logo ? `<img src="${ch.logo}" class="channel-logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiBmaWxsPSIjMzMzIj48L3JlY3Q+PHRleHQgeD0iMjQiIHk9IjI4IiBmb250LXNpemU9IjIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSI+TVY8L3RleHQ+PC9zdmc+"></img>` : ''}
                <div class="channel-name">${ch.name}</div>
            `;
            div.onclick = () => playChannel(ch, i);
            channelList.appendChild(div);
        });
    }

    function playChannel(channel, index) {
        // Update active state
        document.querySelectorAll('.channel-item').forEach((el, i) => {
            el.classList.toggle('active', i === index);
        });

        nowPlaying.textContent = `Now Playing: ${channel.name}`;
        loader.style.display = 'block';

        if (Hls.isSupported()) {
            if (window.hls) window.hls.destroy();
            window.hls = new Hls({ enableWorker: true });
            window.hls.loadSource(channel.url);
            window.hls.attachMedia(video);
            window.hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play().catch(() => {});
                loader.style.display = 'none';
            });
            window.hls.on(Hls.Events.ERROR, (event, data) => {
                console.error('HLS Error:', data);
                loader.style.display = 'none';
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = channel.url;
            video.play().catch(() => {});
            loader.style.display = 'none';
        } else {
            alert('HLS not supported in your browser');
            loader.style.display = 'none';
        }
    }

    // Load playlist
    if (typeof playlistContent !== 'undefined') {
        parseM3U(playlistContent);
    } else {
        fetch(playlistUrl)
            .then(r => r.text())
            .then(parseM3U)
            .catch(err => {
                channelList.innerHTML = `<p style="color:#ff6b6b; text-align:center;">Failed to load playlist.<br>Check URL or network.</p>`;
                console.error(err);
            });
    }
</script>
</body>
</html>
